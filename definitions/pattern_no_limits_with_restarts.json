{
    "version": "kubepattern.it/v1",
    "kind": "Pattern",
    "metadata": {
        "name": "no-limits-with-restarts",
        "displayName": "No Resource Limits With Restarts",
        "patternType": "BEHAVIORAL",
        "severity": "WARNING",
        "category": "Performance",
        "description": "Identifies pods without resource limits that are experiencing restarts. While unlimited resources can cause cluster-wide issues, restarts in such pods suggest they may need explicit limits to prevent OOM kills by the node."
    },
    "spec": {
        "message": "Pod {{unlimited-pod.name}} in namespace {{unlimited-pod.namespace}} has no memory limits defined and has restarted many times. Without limits, the pod may be killed by the node's OOM killer. Set appropriate memory limits to ensure predictable behavior.",
        "topology": "SINGLE",
        "resources": [
            {
                "resource": "Pod",
                "id": "unlimited-pod",
                "leader": true,
                "filters": {
                    "matchAll": [
                        {
                            "key": ".status.containerStatuses[*].restartCount",
                            "operator": "GREATER_THAN",
                            "values": ["0"]
                        }
                    ],
                    "matchAny": [
                        {
                            "key": ".spec.containers[*].resources.limits.memory",
                            "operator": "IS_EMPTY",
                            "values": []
                        }
                    ],
                    "matchNone": [
                        {
                            "key": ".metadata.namespace",
                            "operator": "EQUALS",
                            "values": [
                                "kube-system",
                                "kube-public",
                                "kube-node-lease",
                                "krateo-system"
                            ]
                        }
                    ]
                }
            }
        ],
        "actors": [
            "unlimited-pod"
        ]
    }
}