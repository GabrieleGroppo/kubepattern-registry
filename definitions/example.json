{
    "version": "kubepattern.it/v1",
    "kind": "Pattern",
    "metadata": {
        "name": "example",
        "displayName": "Example",
        "patternType": "STRUCTURAL",
        "severity": "INFO",
        "category": "testing",
        "gitUrl": "https://github.com/GabrieleGroppo/kubepattern-registry/tree/main/doc/example.md",
        "docUrl": "https://github.com/GabrieleGroppo/kubepattern-registry/tree/main/doc/example.json",
        "description": "This pattern aims to test kubepattern tool in multiple relationships orchestration."
    },
    "spec": {
        "message": "",
        "topology": "LEADER_FOLLOWER",
        "leader": "resource-test-leader",
        "resources": [
            {
                "resource": "Pod",
                "id": "resource-test-leader",
                "filters": {
                    "matchAll": [
                        {
                            "key": ".spec.volumes",
                            "operator": "EXISTS",
                            "values": []
                        }
                    ],
                    "matchNone": [
                        {
                            "key": ".metadata.namespace",
                            "operator": "EQUALS",
                            "values": [
                                "kube-system",
                                "kube-public",
                                "kube-node-lease",
                                "krateo-system"
                            ]
                        }
                    ],
                    "matchAny": [
                        {
                            "key": ".metadata.name",
                            "operator": "EQUALS",
                            "values": [
                                "application",
                                "frontend",
                                "backend",
                                "api",
                                "web",
                                "service"
                            ]
                        },
                        {
                            "key": ".metadata.labels.app",
                            "operator": "EQUALS",
                            "values": [
                                "frontend",
                                "backend",
                                "application"
                            ]
                        },
                        {
                            "key": ".metadata.labels.tier",
                            "operator": "EQUALS",
                            "values": [
                                "web",
                                "api",
                                "frontend",
                                "backend"
                            ]
                        }
                    ]
                }
            },
            {
                "resource": "Pod",
                "id": "resource-test-follower",
                "filters": {
                    "matchAll": [
                        {
                            "key": ".spec.volumes",
                            "operator": "EXISTS",
                            "values": []
                        }
                    ],
                    "matchNone": [
                        {
                            "key": ".metadata.namespace",
                            "operator": "EQUALS",
                            "values": [
                                "kube-system",
                                "kube-public",
                                "kube-node-lease"
                            ]
                        }
                    ],
                    "matchAny": [
                        {
                            "key": ".metadata.name",
                            "operator": "EQUALS",
                            "values": [
                                "logging",
                                "logger",
                                "log",
                                "log-collector",
                                "log-shipper",
                                "fluentd",
                                "filebeat",
                                "logstash"
                            ]
                        },
                        {
                            "key": ".metadata.labels.app",
                            "operator": "EQUALS",
                            "values": [
                                "logging",
                                "logger",
                                "log-collector"
                            ]
                        },
                        {
                            "key": ".metadata.labels.component",
                            "operator": "EQUALS",
                            "values": [
                                "log-collector",
                                "log-shipper",
                                "logging",
                                "monitoring",
                                "metrics"
                            ]
                        }
                    ]
                }
            },
            {
                "resource": "Namespace",
                "id": "resource-test-namespace",
                "filters": {
                    "matchAll": [],
                    "matchNone": [
                        {
                            "key": ".metadata.name",
                            "operator": "EQUALS",
                            "values": [
                                "kube-system",
                                "kube-public",
                                "kube-node-lease"
                            ]
                        }
                    ],
                    "matchAny": []
                }
            }
        ],
        "relationships": [
            {
                "id": "rel-1-shared-volume-mount",
                "type": "MOUNTS",
                "description": "Testing relationship 1 - Both pods share the same volume mount.",
                "weight": 0.6,
                "required": true,
                "shared": true,
                "resourceIds": [
                    "resource-test-leader",
                    "resource-test-follower"
                ]
            },
            {
                "id": "rel-2-namespace-coupling",
                "type": "IS_NAMESPACE_OF",
                "description": "Testing relationship 2 - Both pods are deployed in the same namespace.",
                "weight": 0.6,
                "required": true,
                "shared": true,
                "resourceIds": [
                    "resource-test-leader",
                    "resource-test-follower",
                    "resource-test-namespace"
                ]
            }
        ],
        "confidenceThreshold": 0.7,
        "evidence": {
            "required": [
                "rel-1-shared-volume-mount",
                "rel-2-namespace-coupling"
            ],
            "optional": []
        }
    }
}
