{
    "version": "kubepattern.it/v1",
    "kind": "Pattern",
    "metadata": {
        "name": "health-probe-missing",
        "displayName": "Health Probe Missing",
        "patternType": "FOUNDATIONAL",
        "severity": "WARNING",
        "category": "Reliability",
        "gitUrl": "https://github.com/GabrieleGroppo/kubepattern-registry/tree/main/doc/health-probe-missing.json",
        "docUrl": "https://github.com/GabrieleGroppo/kubepattern-registry/tree/main/doc/health-probe-pattern.json",
        "description": "Identifies pods that lack proper health probes (liveness and readiness probes). Health probes are essential for Kubernetes to determine if containers are running correctly and ready to accept traffic. Without these probes, Kubernetes cannot automatically restart unhealthy containers or route traffic away from containers that are not ready, leading to potential service disruptions and degraded user experience."
    },
    "spec": {
        "message": "Pod '{{single-pod.name}}' in namespace '{{single-pod.namespace}}' does not have both liveness and readiness probes configured.",
        "topology": "SINGLE",
        "resources": [
            {
                "resource": "Pod",
                "id": "single-pod",
                "leader": true,
                "filters": {
                    "matchNone": [
                        {
                            "key": ".metadata.namespace",
                            "operator": "EQUALS",
                            "values": [
                                "kube-system",
                                "kube-public",
                                "kube-node-lease",
                                "krateo-system"
                            ]
                        }
                    ],
                    "matchAny": [
                        {
                            "key": ".spec.containers[*].livenessProbe",
                            "operator": "NOT_EXISTS",
                            "values": []
                        },
                        {
                            "key": ".spec.containers[*].readinessProbe",
                            "operator": "NOT_EXISTS",
                            "values": []
                        }
                    ]
                }
            }
        ],
        "actors": [
            "single-pod"
        ]
    }
}
